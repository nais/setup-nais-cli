# Setup Nais CLI Action

A GitHub Action to install the [Nais CLI](https://github.com/nais/cli) by downloading pre-built binaries from GitHub releases.

## Usage

### Install Latest Version

```yaml
steps:
  - uses: nais/setup-nais-cli@alpha
  - name: Use nais CLI
    run: nais --version
```

### Install Specific Version

```yaml
steps:
  - uses: nais/setup-nais-cli@alpha
    with:
      version: v3.8.3
  - name: Use nais CLI
    run: nais --version
```

## Inputs

| Name      | Description                                                 | Required | Default  |
| --------- | ----------------------------------------------------------- | -------- | -------- |
| `version` | Version of nais CLI to install (e.g., `v3.8.3` or `latest`) | No       | `latest` |

## Supported Platforms

This action supports Linux GitHub runners:

- Linux (amd64, arm64)

**Note**: This action is designed specifically for Linux environments.

## Features

- ✅ Downloads pre-built binaries for fast installation
- ✅ Verifies checksums for security
- ✅ Optimized for Linux environments
- ✅ Caches downloads for improved performance
- ✅ Supports both latest and specific version installation

## What Changed

This action previously built the nais CLI from source, which was slow and required additional dependencies (Go, mise). The new implementation:

1. Downloads pre-built binaries from GitHub releases
2. Verifies checksums for security
3. Installs much faster (seconds vs minutes)
4. Supports version pinning for reproducible builds
5. Works across all supported platforms

## Migration

If you were using the old version, no changes are required in your workflow files. The action will now install the latest version by default instead of building from source.

To pin to a specific version (recommended for production):

```yaml
- uses: nais/setup-nais-cli@alpha
  with:
    version: v3.8.3 # Pin to specific version
```

## Development

This action uses [Mise](https://mise.jdx.dev/) for development tooling and task management.

### Prerequisites

- [Mise](https://mise.jdx.dev/getting-started.html) installed

### Setup

```bash
# Trust and install tools (shellcheck)
mise trust
mise install
```

### Available Tasks

```bash
# Show all available tasks
mise tasks

# Run linting (shellcheck) on all bash scripts
mise run lint

# Run tests for the individual scripts
mise run test

# Run both linting and tests
mise run check

# Clean up test artifacts
mise run clean
```

### Project Structure

```
├── action.yaml              # GitHub Action definition
├── scripts/                 # Modular bash scripts
│   ├── detect-platform.sh   # Platform/architecture detection
│   ├── get-release.sh       # Release information fetching
│   └── install-nais.sh      # Download, verify, and install
├── test-scripts.sh          # Test script for all components
├── .mise.toml               # Mise configuration for tools and tasks
└── .shellcheckrc            # Shellcheck configuration
```

The scripts are designed to be:

- **Modular**: Each script has a single responsibility
- **Testable**: Can be tested individually and in combination
- **Linted**: All scripts pass shellcheck validation
- **Maintainable**: Clear separation of concerns

### Releases

To create a new release:

```bash
# Run tests first
mise run check

# Create and push a release (will trigger automated workflow)
mise run release -- 1.0.0
```

See [RELEASE.md](RELEASE.md) for detailed release process documentation.

## Code generated by GitHub Copilot

This repository uses GitHub Copilot to generate code.
